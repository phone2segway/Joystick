<html>
   
    	<head>
    		
    	<meta name="viewport" content="width=device-width" />	
    		
         <script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
        <script type="text/javascript" src="js/underscore-min.js"></script>
        <script type="text/javascript" src="js/backbone-min.js"></script>
        <script type="text/javascript" src="js/joystick_view.js"></script>
        
         <script>
      // If we're running on a real web server (as opposed to localhost, which is whitelisted),
      // then change the protocol to HTTPS.
      // See https://goo.gl/lq4gCo for an explanation as to why this is needed for some features.
      (function() {
        var isLocalhost = !!(window.location.hostname === 'localhost' ||
          // [::1] is the IPv6 localhost address.
          window.location.hostname === '[::1]' ||
          // 127.0.0.1/8 is considered localhost for IPv4.
          window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));
        if (window.location.protocol === 'http:' && !isLocalhost) {
          // Redirect to https: if we're currently using http: and we're not on localhost.
          window.location.protocol = 'https:';
        }
      })();
      window.addEventListener('error', function(error) {
        if (ChromeSamples && ChromeSamples.setStatus) {
          ChromeSamples.setStatus(error.message + ' (Nettleseren din støtter ikke Web Bluetooth.)');
          error.preventDefault();
        }
      });
    </script>
    
    </head>
    <body>

@media only screen and (max-width: 480px), only screen and (max-device-width: 480px) {

     #content{
          width: 100%;
     }

img{
          max-width:100%;
          height:auto;
     }

}

   <center> <script type="text/html" id="joystick-view"> </center>
   <canvas id="joystickCanvas" width="<%= squareSize %>" height="<%= squareSize %>" style="width: <%= squareSize %>px; height: <%= squareSize %>px;">
        </canvas>
    </script>

    <div id="joystickContent">
    </div>
    <div>
      <center>  x: <span id="xVal"></span><br/></center>
      <center>  y: <span id="yVal"></span><br/></center>
    </div>

    <script type="text/javascript">
        $(document).ready(function(){
            var joystickView = new JoystickView(150, function(callbackView){
                $("#joystickContent").append(callbackView.render().el);
                setTimeout(function(){
                    callbackView.renderSprite();
                }, 0);
            });
            joystickView.bind("verticalMove", function(y){
                $("#yVal").html(y);
            });
            joystickView.bind("horizontalMove", function(x){
                $("#xVal").html(x);
            });
        });
    </script>
    	
      		<form>
		 <br> <div><label for="service">Service: </label><input id="service" type="text" list="services" autofocus placeholder="Bluetooth Service" value="6e400001-b5a3-f393-e0a9-e50e24dcca9e"></div></br>
		  <br><div><label for="service">Characteristic: </label><input id="characteristic" type="text" list="characteristics" placeholder="Bluetooth Characteristic" value="6e400002-b5a3-f393-e0a9-e50e24dcca9e"></div></br>
	       
		  <br><div><button id="connect" >Koble til enhet</button></div></br>
		</form>
	
	<script>
		  var ChromeSamples = {
			log: function() {
			  var line = Array.prototype.slice.call(arguments).map(function(argument) {
				return typeof argument === 'string' ? argument : JSON.stringify(argument);
			  }).join(' ');
			  document.querySelector('#log').textContent += line + '\n';
			},
			clearLog: function() {
			  document.querySelector('#log').textContent = '';
			},
			setStatus: function(status) {
			  document.querySelector('#status').textContent = status;
			},
			setContent: function(newContent) {
			  var content = document.querySelector('#content');
			  while(content.hasChildNodes()) {
				content.removeChild(content.lastChild);
			  }
			  content.appendChild(newContent);
			}
		  };
		</script>
		
		
		<div id="output" class="output">
		  <div id="content"></div>
		  <div id="status"></div>
		  <pre id="log"></pre>
		</div>
		
                <script>
          		var myCharacteristic;
      			
      			 // Søker etter enheter
      			function onFormSubmit() {
				  'use strict';
				  let serviceUuid = document.getElementById('service').value;
				  if (serviceUuid.startsWith('0x')) {
					serviceUuid = parseInt(serviceUuid, 16);
				  }
				  let characteristicUuid = document.getElementById('characteristic').value;
				  if (characteristicUuid.startsWith('0x')) {
					characteristicUuid = parseInt(characteristicUuid, 16);
				  }
				  log('Søker etter enheter med valgt service og characteristic...');
				  navigator.bluetooth.requestDevice({filters: [{services: [serviceUuid]}]})
				  .then(device => device.connectGATT())
				  .then(server => server.getPrimaryService(serviceUuid))
				  .then(service => service.getCharacteristic(characteristicUuid))
				  .then(characteristic => {
				  		myCharacteristic = characteristic;
				  		log('> Tilkoblet enhet. Segway kan nå styres.');
					})
				  .catch(error => {
					log('Feil ' + error);
				  });
				}
				</script>
	<script>
  document.querySelector('form').addEventListener('submit', function(event) {
    event.stopPropagation();
    event.preventDefault();
    if (!navigator.bluetooth) {
      ChromeSamples.setStatus('Web Bluetooth API er ikke tilgjengelig.\n' +
        'Husk å aktivere Web Bluetooth-flagget: chrome://flags');
    } else {
      ChromeSamples.clearLog();
      onFormSubmit();
    }
  });
  log = ChromeSamples.log;
</script>	
 
    
    </body>
</html>
